%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - 構文解析器のテスト

a(-3.14*. .14E-04+ -5) % ==> a(-4.396E-5+ -5)

p(10-6-3.14* -3.14)    % ==> p(10-6-3.14* -3.14)

p("a\"\\b")            % ==> 変わらず

p('a''b')              % ==> 変わらず

% #"A"                 % ==> 65 【未実装】

p([1,2,3|X],[4,5],[],result(X)) % ==> 変わらず

(a(X) :- string(X) | ok(X)). a(1),a('2'),a("3"),a([[4]]) % ==> a(1),a(2),ok("3"),ok("4")

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - 基本テスト

append(c(1,c(2,c(3,n))),c(4,c(5,n)),result), ( append(X,Y,Z), n(X) :- Y=Z ), ( append(X,Y,Z), c(A,X1,X) :- c(A,Z1,Z), append(X1,Y,Z1) )

append(c(1,c(2,c(3,n))),c(4,c(5,n)),result).
append(X,Y,Z), n(X) :- Y=Z.
append(X,Y,Z), c(A,X1,X) :- c(A,Z1,Z), append(X1,Y,Z1).

append([1,2,3],[4,5],result), ( Z=append([],Y) :- Y=Z ), ( Z=append([A|X],Y) :- Z=[A|append(X,Y)] )

append([1,2,3],[4,5],result).
Z=append([],Y) :- Y=Z.
Z=append([A|X],Y) :- Z=[A|append(X,Y)].

[[/*inline*/System.out.println(me.nth(0));]]("Linked\n\tMultisets of\n\t\tNodes")

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - アトム主導コンパイルのテスト（作成中）

{a} :- .

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - アトム同一性検査のテスト

f(A),a(A,B),f(C),a(D,C) :- end(B,D).     a(f,f),a(f,f)   % ==> end(f,f) 
f(A),a(A,B),f(C),a(C,D) :- end(B,D).     a(f,f),a(f,f)   % ==> end(f,f)
f(A),a(A,B),a(D,C),f(C) :- end(B,D).     a(f,f),a(f,f)   % ==> end(f,f) 
p(A),f(X),p(X) :- unary(A) | .           p(f),p(f),p(f)  % ==> p(f)
{p(A),f(X),p(X),$s[A]} :- {$s[X],q(X)}. {p(f),p(f),p(f)} % ==> {p(f),q(f)}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - 単一化 = のテスト

p(X,X)     % ==> 変わらず
p(X,Y),Y=X % ==> p(X,X)
X=X        % ==> ()
X=Y,Y=X    % ==> ()
[1]=res    % ==> res([1])
X=[1|X]    % ==> '.'(1,X,X)


p(a,b), ( p(X,Y)     :- X=Y     ) % ==> a(b)
p(a,b), ( Y=p(X)     :- X=Y     ) % ==> a(b)
p(a,b), ( Y=E,E=p(X) :- X=F,F=Y ) % ==> a(b)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - 自由リンク管理アトムのテスト

% 生成のテスト
b(X),{c(X)}
% マッチングのテスト
b(X),{c(X)}, (b(X),{c(X)}:- ok) % ==> ok
% 生成とマッチングのテスト
a, (a:-b(X),{c(X)}), (b(X),{c(X)}:-d(Y),{e(Y)}) % ==> d(X),{e(X)}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - プロセス文脈のテスト

1,1,1,1,1,{},({$p},1:-{$p,1}) % ==> {1,1,1,1,1}
{{a(X)},b(X,Y),1},{c(Y)}, ({$p,1} :- {$p}) % ==> {{a(X)},b(X,Y)},{c(Y)}

% RemoveProxies のテスト
{{a(X)},b(X,Y)},{c(Y)},      ({$p},{$q} :- {$p,$q}) % ==> {{a(X)},c(b(X))}
% RemoveToplevelProxies のテスト
{a(  X)},{b(X)},             ({$p},{$q} :-  $p,$q ) % ==> a(b)
{a(A,X)},{b(X)},c(A),        ({$p},{$q} :-  $p,$q ) % ==> b(a(c))

% InsertProxies のテスト
{{a(A,X)},b(B,X)},c(A,B),    ({{$p},$q} :- {$p,$q}) % ==> {b(B,a(A))},c(A,B)}

% 全般
{{a(A,X)},b(B,X)},{d(B)},c(A),  ( {{$p},$q},{$r}   :- {{$p},$q,  $r} ) % ==> {{a(A,X)},b(d,X)},c(A)
{{a(A,X)},b(B,X)},{d(B)},c(A),a,( {{$p},$q},{$r},a :- {{$p},$q},{$r} ) % ==> {{a(A,X)},b(B,X)},{d(B)},c(A)
{{a(A,X)},b(B,X)},{d(B)},c(A),  ( {{$p},$q},{$r}   :- {$p,$q,$r}     ) % ==> {a(X,b(d))},c(X)
{{a(A,X)},b(B,X)},{d(B)},c(A),  ( {{$p},$q},{$r}   :-  $p,$q,$r      ) % ==> a(c)=b(d)

{{a(X)},b(X)},               ({{$p},$q} :- $p,$q) % ==> a(b)
{{a(X)},b(X,Y)}, c(Y),       ({{$p},$q} :- $p,$q) % ==> c(b(a))
{{a(A,X)},b(B,X)},1(A),2(B), ({{$p},$q} :- $p,$q) % ==> a(1)=b(2)

{a(A,X)},{b(X)},{c(A)},      ({$p},{$q} :- {$p,$q}) % ==> {b(a(c))}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - ルール文脈のテスト

{@p}:-@p. a. {a:-b} % ==> b

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - システムルールセットのテスト

{p(X,Y), (p(X,Y) :- X=Y)}, a(X,Y) % ==>  a(X,X), {}
{a(X,Y)}, p(X,Y), (p(X,Y) :- X=Y) % ==> {a(X,X)}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - 組み込み機能のテスト

p((123-45-67+89)/(10*10)) % ==> 1
cp(4+5,B,C), res(B*C)     % ==> res(81)
p(2/0)                    % ==> p(2/0)
p(2 mod 0)                % ==> p(2 mod 0)
p(float(2)+. 1.0 +..14)   % ==> p(3.14)

p(0.0/.0.0), (p('NaN')       :- err) % ==> p('NaN')【要調整】
p(4.0/.0.0), (p('Infinity')  :- err) % ==> p('Infinity')【要調整】
p(-4.0/.0.0),(p('-Infinity') :- err) % ==> p('-Infinity')【要調整】
p(1.0/.(-4.0/.0.0)), (p(0.0) :- err) % ==> p(-0.0)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - ガードのテスト

(a($p) :- int($p) | b($p))

(a(X) :- int(X)      | b(X),c(X))
(a(X) :- int(X)      | b(X),c(X)), a(4)      % ==> b(4),c(4)

(a(X) :- 4(X),4(X)   | end(X)),    a(4),a(5) % ==> end(4),a(5)
(a    :- 4(X),4(X)   | end(X)),    a         % ==> end(4)
(a(X) :- 4(X),int(X) | end(X)),    a(4)      % ==> end(4)

(a(X,Y) :- X<Y | ok(X,Y)), a(3,4), a(3,3), a(3,2) % ==> ok(3,4), a(3,3), a(3,2)

(a(X) :- X=4         | end(X)),    a(4),a(5) % ==> end(4),a(5)
(a(X) :- 4=X         | end(X)),    a(4),a(5) % ==> end(4),a(5)

(a($p):- $p=4        | end($p)),   a(4),a(5) % ==> end(4),a(5)

(gen(1) :- X=X),(gen(N) :- N>1 | p(N),gen(N-1)), gen(50), (p(A),p(B) :- B=(B/A)*A | p(A)) 
(gen(1) :- X=X),(gen(N) :- N>1 | p(N),gen(N-1)), gen(50), (p(A),p(B) :- B mod A =:= 0 | p(A)) 
(gen(1) :- X=X),(gen(N) :- N>1 | p(N),gen(N-1)), gen(200), (p(A),p(B) :- B mod A =:= 0 | p(A)) 
(gen(1) :- X=X),(gen(N) :- N>1 | p(N),gen(N-1)), gen(700), (p(A),p(B) :- B mod A =:= 0 | p(A)) 
  
%

(f(X):- X >. 3.0 | ok(X)), f(3.0+.0.1),f(3.0),f(2.9),f(3) % 

(p(X) :- X==4 | ok), p(4),p(5) % ==> ok,p(5)
(p(X) :- 4==X | ok), p(4),p(5) % ==> ok,p(5)
(p(X) :- X =:=. 4.0 | ok), p(4),p(4.0) % ==> ok,p(4)

(a :- $p=1 | $p=$p), a % ==> 1(1)
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 明示的な自由リンク引数付きのプロセス文脈のテスト

( {$p[X|*A]} :- $p[X|*A] ), {a(X)},b(X) % ==> a(b)
( {$p[X|*A]} :- $p[X|*B] ), {a(X)},b(X) %【現在リンク束の名前は無視される】

( {$p[X|*A],a(X)} :- $p[X|*A],ok(X) ), {a(4)}        % ==> ok(4)
( {$p[X|*A],a(X)} :- $p[X|*A],ok(X) ), {a(X),{4(X)}} % ==> ok(X),{4(X)}
( {$p[X|*A],a(X)} :- $p[X|*A],ok(X) ), {a(X)},4(X)   % ==> {a(X)},4(X)

( {$p[Y|*A],a(X)} :- $p[X|*A],ok(Y) ), {a(X),b(X)}        % ==> {a(X),b(X)}        == {a(b)}
( {$p[Y|*A],a(X)} :- $p[X|*A],ok(Y) ), {a(X),b(X,Y)},f(Y) % ==> {a(X),b(X,Y)},f(Y) == {b(a,Y)},f(Y)
( {$p[Y|*A],a(X)} :- $p[X|*A],ok(Y) ), {a(X),b(Y)},f(X,Y) % ==> ok(Y),b(X),f(X,Y)  == ok(f(b))

( {$p[X],   a(X)} :- $p[X],   ok(X) ), {a(4)}        % ==> ok(4)
( {$p[X],   a(X)} :- $p[X],   ok(X) ), {a(X),{4(X)}} % ==> ok(X),{4(X)}
( {$p[X],   a(X)} :- $p[X],   ok(X) ), {a(X)},4(X)   % ==> {a(X)},4(X)

( {$p[Y|*A],a(Y)} :- $a=4 | $p[X|*A], $a=X ), {a(b)} % ==> b(4)
			
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

( {f($p)} :- int($p) | ok ), {f(2)},{f(3),a},{f(X)},1(X) % ==> ok,{f(3),a},{f(X)},1(X)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

(sum([],S) :- S=0), (sum([A|Xs],S):-S=A+sum(Xs)), sum([1,2,3,4,5])=print

(gen(K,N,Xs) :- K=N | Xs=[]),(gen(K,N,Xs) :- K<N | Xs=[K|gen(K+1,N)]), gen(3,8)=print

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{({{{a}}}:-e),a} % GETPARENT のテスト

{a,a,a,(a:-b),(e:-a)},({b,b,b,$p,@p}:-{e,$p,@p})

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 明示的な自由リンク引数のテスト

{$p[X,Y]},{$q[Y,Z]}:-{$p[X,Y],$q[Y,Z]}.
{f(A),f(B)},{f(B),f(C)},{f(C),f(A)}

% ガード否定条件のテスト

{$p}:-\+($p=a)|{$p,end}

{$p}:-\+($p=a),\+($p=(end,$pp))|{$p,end}.   {a},{b},{c} % ==> {a},{b,end},{c,end}

{$p[X,Y]},{$q[Y,Z]}:-\+($p=(f(Y),$pp),$q=(f(Y),$qq))|{$p[X,Y],$q[Y,Z]}.
{f(A),f(B)},{f(B),f(C)},{f(C),f(A)}

%

{$p},{$q}:-\+($p=f(X),$q=f(X))|$p,$q.   {f(X)},{f(X)},{f(Y)},{f(Z)},Y==Z
   % ==> f==f,f(f) or f==f,{f(X)},{f(X)}
{$p,{$q}}:-\+($p=f(X),$q=g(X))|$p,$q.   {g(X),{f(X)}},{f(X),{g(X)}}
   % ==> f(g),{f(X),{g(X)}}
{$p,{$q}}:-\+($q=f(X),$p=g(X))|$p,$q.   {g(X),{f(X)}},{f(X),{g(X)}}
   % ==> f(g),{g(X),{f(X)}}

{f(X),$p[X]} :- \+($p=g(X)) | $p[Z],Z=1.   {f(g)},{f(g),a},{f(h)}
   % ==> a,g(1),h(1),{f(g)}

% ガード命令列で変数番号が重複しないことの検査

{$p,f(X)}:-\+($p=a),X>1|$p. {f(1)},{f(1),a},{f(2)},{f(2),a} % ==> {f(1)},{f(1),a},{f(2),a}

% ガード否定条件における型付きプロセス文脈のテスト

{f($p)}      :- \+( $p=1    )       | f(A),$p[A].               % ==> {~3}≠{} なのでマッチしない
{f($p)}      :- \+( $p=1(X) )       | f(A),$p[A].               % ==> {~3}≠{X}なのでマッチしない
{f(X),$p[X]} :- \+( $p=1(X) )       | f(A),$p[A]. {f(1)},{f(2)} % ==> {f(1)},f(2)
{f(X),$p[X]} :- \+( $p=1(X) )       | f($p).      {f(1)},{f(2)} % ==> {f(1)},f(2)
{f(X),$p[X]} :- \+( $p=1(X) ), $t>0 | f(A),$p[A].               % ==> 型付き$pは制約できない

// $t[f]と書けるようにするか？

// 型付きは制約できないことにする
// 否定条件内の$tを含む制約は無視。
// そのような制約に出現するヘッドに出現しない$t'を含む制約は無視。
// $s=$t+1, $s=...

//{$p} :- \+($p=(f(X))), X>1 | $p.			% まだ下のように展開されない
//{$p} :- \+($p=(f(X)), X>1) | $p.			% まだ下のように展開されない
//{$p} :- \+($p=(f(A),$x[A])), $x>1 | $p.	% 未実装
//{$p} :- \+($p=(f(A),$x[A]), $x>1) | $p.	% 未実装

// {$p[X]} :- \+( $p=f(X) ) | ...

// {f($t)} :- \+( $t=1, $t=1 ) | 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 明示的な自由リンク引数の新テスト

{$p[X]},{$q[|*V]} :-  $p[X],$q[|*V].     {f(A)},{g(A,B)}.B=[]  % ==>  g(f,[])
{$p[X]},{$q[|*V]} :- {$p[X],$q[|*V]}.    {f(A)},{g(A,B)}.B=[]  % ==> {g(f,B)},B=[]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 分散処理系のテスト

a:-{a,a,a,a,a. a:-b}@"localhost". a
a:-{b,b,b,b,b. b:-c}@"localhost". a,a,a,a. {$p,@p}:-$p
{a,$p}@A :- $p, hostname=A, {}@A. {a}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 非線型プロセス文脈のテスト

{$p[]} :-$p[],$p[].        {{{a}}}         % ==> a,a,a,a,a,a,a,a
{$p[X]}:-$p[X],$p[Y],n(Y). {{{a(X)}}},e(X) % ==> n(a), n(a), n(a), n(a), n(a), n(a), n(a), e(a)
{$p[X]}:-g(X).             {f(A)},f(A)     % ==> f(g)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 諸々のテスト

  A=f(f(f(f(A)))),    c,c, ( c, X=f(Y) :- X=g(Y) )                      % ==>   f(g(g(f(A))),A)
{ A=f(f(f(f(A)))) },  c,c, ( c,{X=f(Y),$p[X,Y]} :- { X=g(Y),$p[X,Y] } ) % ==> { f(g(g(f(A))),A) }

{$p[X]}:-$p[X], $p[Y],f(Y), $p[Z],$p[Z].  {p(X)},g(X) % ==> f(p), p(g), p(p)

{ pi(X), res(X), ( pi(X) :- X=3.14 ) }, ( {res($p),@r} :- result=$p ) % ==> result(3.14)

( go :- { pi(X), res(X), ( pi(X) :- X=3.14 ) }@"localhost" ),
( {res($p),@r} :- result=$p ),
( result(pi) :- e,go ),
go. % ==> e,e,e,result(3.14)

( {f(X),$p[X]} :- { g(X),$p[X] } )

{$p[X]}:-$p[X].

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% UpdateLinks のテスト

                          go :- 4($pc)   |               atom(X), $pc[X] % NEWLINK
          { org(Y), $pc[Y] } :-                          atom(X), $pc[X] % RELINK
                                            buddy(X) :-  atom(X)         % RELINK
                          go :-             buddy(X),    atom(X)         % NEWLINK
              buddy(X)       :- 4($atom) |              $atom[X]         % RELINK
              go :- 5($buddypc),4($atom) | $buddypc[X], $atom[X]         % NEWLINK
{org(Y), $buddypc[Y]}        :- 4($atom) | $buddypc[X], $atom[X]         % RELINK
                      {src(Z),$atom[Z]},    buddy(X) :- $atom[X]         % (LOCAL)UNIFY
{org(Y), $buddypc[Y]},{src(Z),$atom[Z]} :- $buddypc[X], $atom[X]         % UNIFY

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{$p[X,Y],f(X,Y)}:-$p[Z,Z],$p[W,W].    {f(X,Z),g(X,Z)} % ==> g(A,A),g(B,B)
{$p[X,Y],f(X,Y)}:-$p[Z,Z].            {f(X,Z),g(X,Z)} % ==> g(A,A)
{$p[X,Y],f(X,Y)}:-$p[Z,Z],$p[W,W].    {f(X,X)}        % ==> g(A,A),g(B,B) 【Null】※1
{$p[X,Y],f(X,Y)}:-$p[Z,Z],$p[W,W].    {f(X,Y)},u(X,Y) %%%%


{$p[X,Y],f(X,Y)}:-$p[Z,Z].            {f(X,X)}        % ==> ()

{$p[X,Y]} :- $p[A,B],$p[A,B].  {f(X,Y)},g(X,Y)

{$p[X,Y,Z],f(X),f(Y),f(Z)} :- $p[V,V,W],g(W).   {f(A),f(A),f(C),f(C)} % ==> f(g)
{$p[X,Y,Z],f(X,$x),f(Y,$y),f(Z,$z)} :- int($x),int($y),int($z) | $p[V,V,W],g(W).   {f(A,1),f(A,2),f(C,3),f(C,4)} % ==> f(g,1) or ... or f(g,4)

{$p[A,B,C,D,E], f(A,B,C,D,E)} :- $p[L,L,M,M,N],g(N).  {e(A),f(A,B,B,C,C)} % ==> e(g)
{$p[A,B,C,D,E], f(A,B,C,D,E)} :- $p[L,L,M,M,N],g(N).  {e(A),f(A,B,C,C,B)} % ==> e(g)
{$p[A,B,C,D,E], f(A,B,C,D,E)} :- $p[L,L,M,M,N],g(N).  {e(A),f(A,B,C,D,E),h(B,C,D,E)} % ==> g(h(e,C,C))

p(A,B,C,D,E) :- A=B,C=D,g(E).  e(A),p(A,B,B,C,C). % ==> e(g)

{$p[A,B,C,D,E], f(A,B,C,D,E)} :- $p[L,L,M,M,N],g(N), $p[A,A,B,B,C],g(C).  {e(A),f(A,B,B,C,C)} % ==> 【Null】

{$p[A,B,C,D,E], f(A,B,C,D,E)} :- $p[L,L,M,M,N],g(N), $p[A,A,B,B,C],g(C).  {e(A,B,C,D,E),f(A,B,C,D,E)} % ==> 【Null】


rule with empty head due to syntax error -> must stop!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%