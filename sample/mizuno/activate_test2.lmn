//※修正済※
//仮スタックを利用すべきかどうかの判断がおかしい事によって問題が起きる例
//-O オプションを使うと問題が起きていた。

gen.
gen :-
{do.
	{ {a}.
	  //下の2つのルールは交互に適用できるはずだが、ルート膜が仮の実行膜スタックに
	  //積まれた状態で適用すると子膜を仮の実行膜スタックに積んでしまう。
	  //そのため、この膜よりも底側に積まれ、完全な検査が行われなくなる
	  {a}:-{b. b:-c.}.
	  {c,@p}:-{a}.
	}
}@"localhost".
{do,$p} :- {$p}, [:/*inline*/System.out.println("start");try{Thread.sleep(1000);}catch(Exception e){}System.out.println("done");:].
