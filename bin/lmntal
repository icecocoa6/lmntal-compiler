#!/bin/bash

source "`dirname "$0"`/set_cp.sh"
if [ -x /usr/bin/cygpath ]; then
	CLASSPATH=`cygpath -wp "$CLASSPATH"`
	LMNTAL_HOME=`cygpath -wp "$LMNTAL_HOME"`
fi

level5=false
slimcode=false
for arg in $*
do
    if [ $arg = -O5 ]; then
	level5=true
    fi
    if [ $arg = --slimcode ]; then
	slimcode=true;
    fi
    if [ ${arg%%.lmn} != $arg ];then
	lmnfile=${arg%%.lmn}
	lmntal_syntax_il=${lmnfile}_lmntal_syntax_il.lmn
    fi
done



optlibpath=$LMNTAL_HOME/sample/iwasawa/optimize
if [ $level5 = true -a $slimcode = true ]; then
    
    java -DLMNTAL_HOME="$LMNTAL_HOME" runtime.FrontEnd --slimcodelmnsyntax --interpret "$@" > ${lmntal_syntax_il}
   
    java -DLMNTAL_HOME="$LMNTAL_HOME" runtime.FrontEnd --interpret --slimcode -O3 \
    ${lmntal_syntax_il} ${optlibpath}/optimizeMain.lmn ${optlibpath}/reuse.lmn ${optlibpath}/merge.lmn ${optlibpath}/outputIL.lmn  |  slim  -

    rm ${lmntal_syntax_il}

else
    java -DLMNTAL_HOME="$LMNTAL_HOME" runtime.FrontEnd --interpret "$@"  
fi